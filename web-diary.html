<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebÊó•Ë®ò„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f6fa;
            color: #2c3e50;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 3fr 2fr;
            }
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            opacity: 0.8;
        }
        .mood-button, .weather-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .tag {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background-color: #3498db;
            color: white;
            border-radius: 20px;
            cursor: pointer;
        }
        .tag.selected {
            background-color: #2980b9;
        }
        .save-button {
            width: 100%;
            padding: 10px;
            background-color: #3498db;
            color: white;
            font-size: 16px;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        .calendar-header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .calendar-day, .calendar-date {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #eee;
            border-radius: 4px;
            font-size: 14px;
        }
        .calendar-day {
            font-weight: bold;
            background-color: #3498db;
            color: white;
        }
        .calendar-date {
            cursor: pointer;
        }
        .calendar-date:hover {
            background-color: #ddd;
        }
        .calendar-date.selected {
            background-color: #2ecc71;
            color: white;
        }
        .calendar-date.today {
            background-color: #f1c40f;
            color: black;
            font-weight: bold;
        }
        .calendar-date.has-entry {
            background-color: #e67e22;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .edit-delete-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .edit-button, .delete-button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .edit-button {
            background-color: #3498db;
            color: white;
        }
        .delete-button {
            background-color: #e74c3c;
            color: white;
        }
        .confirm-dialog {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .confirm-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            text-align: center;
            border-radius: 8px;
        }
        .confirm-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <textarea id="entry" placeholder="‰ªäÊó•„ÅØ„Å©„Çì„Å™‰∏ÄÊó•„Åß„Åó„Åü„ÅãÔºü" maxlength="500"></textarea>
            <div>
                <h3>Ê∞óÂàÜ</h3>
                <div class="button-group" id="mood-buttons">
                    <button class="mood-button" data-mood="„Å®„Å¶„ÇÇËâØ„ÅÑ" style="background-color: #2ecc71;">üòä</button>
                    <button class="mood-button" data-mood="ËâØ„ÅÑ" style="background-color: #3498db;">üôÇ</button>
                    <button class="mood-button" data-mood="ÊôÆÈÄö" style="background-color: #f1c40f;">üòê</button>
                    <button class="mood-button" data-mood="ÊÇ™„ÅÑ" style="background-color: #e67e22;">üôÅ</button>
                    <button class="mood-button" data-mood="„Å®„Å¶„ÇÇÊÇ™„ÅÑ" style="background-color: #e74c3c;">üò¢</button>
                </div>
            </div>
            <div>
                <h3>Â§©Ê∞ó</h3>
                <div class="button-group" id="weather-buttons">
                    <button class="weather-button" data-weather="Êô¥„Çå" style="background-color: #f1c40f;">‚òÄÔ∏è</button>
                    <button class="weather-button" data-weather="Êõá„Çä" style="background-color: #bdc3c7;">‚òÅÔ∏è</button>
                    <button class="weather-button" data-weather="Èõ®" style="background-color: #3498db;">üåßÔ∏è</button>
                    <button class="weather-button" data-weather="Èõ™" style="background-color: #ecf0f1;">üå®Ô∏è</button>
                </div>
            </div>
            <div>
                <h3>„Çø„Ç∞ (ÊúÄÂ§ß3„Å§)</h3>
                <div id="tags">
                    <span class="tag" data-tag="#‰ªï‰∫ã">#‰ªï‰∫ã</span>
                    <span class="tag" data-tag="#Ë∂£Âë≥">#Ë∂£Âë≥</span>
                    <span class="tag" data-tag="#ÂÆ∂Êóè">#ÂÆ∂Êóè</span>
                    <span class="tag" data-tag="#ÊóÖË°å">#ÊóÖË°å</span>
                    <span class="tag" data-tag="#È£ü‰∫ã">#È£ü‰∫ã</span>
                    <span class="tag" data-tag="#ÈÅãÂãï">#ÈÅãÂãï</span>
                </div>
            </div>
            <button class="save-button" onclick="saveEntry()">‰øùÂ≠ò</button>
        </div>
        <div class="card">
            <div id="calendar" class="calendar"></div>
            <div id="selected-entry"></div>
        </div>
    </div>

    <div id="entryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalDate"></h2>
            <p id="modalEntry"></p>
            <p id="modalMood"></p>
            <p id="modalWeather"></p>
            <p id="modalTags"></p>
            <div class="edit-delete-buttons">
                <button class="edit-button" onclick="editEntry()">Á∑®ÈõÜ</button>
                <button class="delete-button" onclick="confirmDelete()">ÂâäÈô§</button>
            </div>
        </div>
    </div>

    <div id="confirmDialog" class="confirm-dialog">
        <div class="confirm-content">
            <p>Êú¨ÂΩì„Å´„Åì„ÅÆÊó•Ë®ò„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü</p>
            <div class="confirm-buttons">
                <button onclick="deleteEntry()">„ÅØ„ÅÑ</button>
                <button onclick="cancelDelete()">„ÅÑ„ÅÑ„Åà</button>
            </div>
        </div>
    </div>

    <script>
        let selectedMood = '';
        let selectedWeather = '';
        let selectedTags = [];
        let entries = {};
        let currentDate = new Date();
        let editingDate = null;

        // Load entries from localStorage
        if (localStorage.getItem('diaryEntries')) {
            entries = JSON.parse(localStorage.getItem('diaryEntries'));
        }

        // Mood selection
        document.querySelectorAll('.mood-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.mood-button').forEach(b => b.style.opacity = '1');
                button.style.opacity = '0.6';
                selectedMood = button.dataset.mood;
            });
        });

        // Weather selection
        document.querySelectorAll('.weather-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.weather-button').forEach(b => b.style.opacity = '1');
                button.style.opacity = '0.6';
                selectedWeather = button.dataset.weather;
            });
        });

        // Tag selection
        document.querySelectorAll('.tag').forEach(tag => {
            tag.addEventListener('click', () => {
                if (tag.classList.contains('selected')) {
                    tag.classList.remove('selected');
                    selectedTags = selectedTags.filter(t => t !== tag.dataset.tag);
                } else if (selectedTags.length < 3) {
                    tag.classList.add('selected');
                    selectedTags.push(tag.dataset.tag);
                }
            });
        });

        function saveEntry() {
            const entry = document.getElementById('entry').value;
            if (!entry) return;

            const dateToSave = editingDate || new Date().toISOString().split('T')[0];
            entries[dateToSave] = {
                text: entry,
                mood: selectedMood,
                weather: selectedWeather,
                tags: selectedTags
            };

            localStorage.setItem('diaryEntries', JSON.stringify(entries));

            // Reset form
            document.getElementById('entry').value = '';
            document.querySelectorAll('.mood-button, .weather-button').forEach(b => b.style.opacity = '1');
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('selected'));
            selectedMood = '';
            selectedWeather = '';
            selectedTags = [];
            editingDate = null;

            renderCalendar();
            updateSelectedEntry();
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);

            const headerDiv = document.createElement('div');
            headerDiv.className = 'calendar-header';
            headerDiv.innerHTML = `
                <button onclick="changeMonth(-1)">&lt;</button>
                <span>${year}Âπ¥${month + 1}Êúà</span>
                <button onclick="changeMonth(1)">&gt;</button>
            `;
            calendar.appendChild(headerDiv);

            const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            dayNames.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;
                calendar.appendChild(dayDiv);
            });

            for (let i = 0; i < firstDay.getDay(); i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-date';
                calendar.appendChild(emptyDay);
            }

            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateDiv = document.createElement('div');
                dateDiv.className = 'calendar-date';
                dateDiv.textContent = day;

                const date = new Date(year, month, day);
                const dateString = date.toISOString().split('T')[0];

                if (entries[dateString]) {
                    dateDiv.classList.add('has-entry');
                }

                if (date.toDateString() === currentDate.toDateString()) {
                    dateDiv.classList.add('selected');
                }

                if (date.getFullYear() === today.getFullYear() &&
                    date.getMonth() === today.getMonth() &&
                    date.getDate() === today.getDate()) {
                    dateDiv.classList.add('today');
                }

                dateDiv.addEventListener('click', () => selectDate(date));
                calendar.appendChild(dateDiv);
            }

            updateSelectedEntry();
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        function selectDate(date) {
            currentDate = date;
            
            renderCalendar();
        }

        function updateSelectedEntry() {
            const selectedEntryDiv = document.getElementById('selected-entry');
            const dateString = currentDate.toISOString().split('T')[0];
            const entry = entries[dateString];

            if (entry) {
                selectedEntryDiv.innerHTML = `
                    <h3>${currentDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                    <p>${entry.text}</p>
                    <button onclick="showEntry('${dateString}')">Ë©≥Á¥∞„ÇíË¶ã„Çã</button>
                `;
            } else {
                selectedEntryDiv.innerHTML = `
                    <h3>${currentDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                    <p>„Åì„ÅÆÊó•„ÅÆÊó•Ë®ò„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                `;
            }
        }

        function showEntry(date) {
            const entry = entries[date];
            const modal = document.getElementById('entryModal');
            document.getElementById('modalDate').textContent = new Date(date).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('modalEntry').textContent = entry.text;
            document.getElementById('modalMood').textContent = `Ê∞óÂàÜ: ${entry.mood}`;
            document.getElementById('modalWeather').textContent = `Â§©Ê∞ó: ${entry.weather}`;
            document.getElementById('modalTags').textContent = `„Çø„Ç∞: ${entry.tags.join(', ')}`;
            modal.style.display = 'block';
        }

        function editEntry() {
            const dateString = currentDate.toISOString().split('T')[0];
            const entry = entries[dateString];
            if (entry) {
                document.getElementById('entry').value = entry.text;
                selectedMood = entry.mood;
                selectedWeather = entry.weather;
                selectedTags = entry.tags;

                document.querySelectorAll('.mood-button').forEach(button => {
                    button.style.opacity = button.dataset.mood === selectedMood ? '0.6' : '1';
                });

                document.querySelectorAll('.weather-button').forEach(button => {
                    button.style.opacity = button.dataset.weather === selectedWeather ? '0.6' : '1';
                });

                document.querySelectorAll('.tag').forEach(tag => {
                    tag.classList.toggle('selected', selectedTags.includes(tag.dataset.tag));
                });

                editingDate = dateString;
                document.getElementById('entryModal').style.display = 'none';
            }
        }

        function confirmDelete() {
            document.getElementById('confirmDialog').style.display = 'block';
        }

        function deleteEntry() {
            const dateString = currentDate.toISOString().split('T')[0];
            delete entries[dateString];
            localStorage.setItem('diaryEntries', JSON.stringify(entries));
            document.getElementById('entryModal').style.display = 'none';
            document.getElementById('confirmDialog').style.display = 'none';
            renderCalendar();
            updateSelectedEntry();
        }

        function cancelDelete() {
            document.getElementById('confirmDialog').style.display = 'none';
        }

        // Close modal when clicking on <span> (x)
        document.querySelector('.close').onclick = function() {
            document.getElementById('entryModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('entryModal');
            const confirmDialog = document.getElementById('confirmDialog');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
            if (event.target == confirmDialog) {
                confirmDialog.style.display = 'none';
            }
        }

        renderCalendar();
    </script>
</body>
</html>